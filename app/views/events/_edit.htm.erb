<div class="modal fade" id="editEventModal" tabindex="-1" aria-labelledby="editEventModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editEventModalLabel">イベント編集</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <%= form_with(model: event, url: events_path(event), method: :patch, id: "edit-event-form", data: { turbo_frame: "eventModal" }) do |f| %>
          <div class="mb-3">
            <%= f.label :title, "タイトル" %>
            <span data-bs-toggle="tooltip" data-bs-placement="right" title="入力が必須です">
              <i class="fa-solid fa-circle-exclamation tooltip-icon"></i>
            </span>
            <%= f.text_field :title, class: "form-control" %>
          </div>
          <%= f.hidden_field :start_date, id: "start_date" %>
          <div class="mb-3">
            <%= f.label :start_time, "開始時間" %>
            <%= f.time_field :start_time, class: "form-control" %>
          </div>
          <%= f.hidden_field :end_date, id: "end_date" %>
          <div class="mb-3">
            <%= f.label :end_time, "終了時間" %>
            <%= f.time_field :end_time, class: "form-control" %>
          </div>

          <div class="mb-3 d-flex align-items-center justify-content-between">
            <div>
              <%= f.label :line_notify, "LINE通知", class: "form-check-label" %>
            </div>
            <div class="form-check form-switch switch-container">
              <%= f.check_box :line_notify, class: "form-check-input", id: "line-notify-switch" %>
            </div>
          </div>

          <%= f.hidden_field :notify_date, id: "notify_date" %>
          <div class="mb-3" id="notify-time-input" style="display:none;">
            <%= f.label :notify_time, "通知時間", class: "form-label" %>
            <%= f.time_field :notify_time, class: "form-control" %>
          </div>
          
          <%= f.submit "更新", class: "btn btn-primary" %>
          <button type="button" class="btn btn-danger" id="delete-event">削除</button>
        <% end %>
      </div>
    </div>
  </div>
</div>
<turbo-frame id="eventModal">
</turbo-frame>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const notifySwitch = document.getElementById('line-notify-switch');
    const notifyTimeInput = document.getElementById('notify-time-input');

    function toggleNotifyTimeInput() {
      if (notifySwitch.checked) {
        notifyTimeInput.style.display = 'block';
      } else {
        notifyTimeInput.style.display = 'none';
      }
    }

    toggleNotifyTimeInput();
    notifySwitch.addEventListener('change', toggleNotifyTimeInput);

    document.getElementById('delete-event').addEventListener('click', function() {
      const confirmDelete = confirm('このイベントを削除しますか？');
      if (confirmDelete) {
        const form = document.getElementById('edit-event-form');
        form.action = form.action + '/destroy';
        form.method = 'post';
        form.submit();
      }
    });
  });
</script>
